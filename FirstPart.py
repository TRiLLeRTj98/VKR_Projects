#!/usr/bin/env python
# coding: utf-8

# # –ú–Ω–æ–≥–æ–∫–ª–∞—Å—Å–æ–≤–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

# ### –ò–º–ø–æ—Ä—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫
# 
# #### –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –º—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å. –í —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –æ—Ç—Å—É—Ç—Å–≤—É–µ—Ç, —Å–∫–∞—á–∞–µ–º –µ—ë —á–µ—Ä–µ–∑ pip install.

# In[8]:


import pandas as pd
import numpy as np
import os
from tensorflow.keras.layers import Dense, Input, InputLayer, Flatten
from tensorflow.keras.models import Sequential, Model
import tensorflow as tf
import cv2
from tensorflow import keras
import matplotlib.image as mpimg
import warnings
from tensorflow.keras.layers import Conv2D, Flatten, Dense, MaxPool2D, BatchNormalization, GlobalAveragePooling2D
from tensorflow.keras.applications.resnet50 import ResNet50, preprocess_input, decode_predictions
from tensorflow.keras.preprocessing import image
from tensorflow.keras.preprocessing.image import ImageDataGenerator, load_img
from tensorflow.keras.models import Sequential, Model
get_ipython().run_line_magic('matplotlib', 'inline')
import matplotlib.pyplot as plt
from sklearn.datasets import make_moons
from sklearn.metrics import accuracy_score
from sklearn.model_selection import train_test_split
from sklearn.tree import DecisionTreeClassifier
from sklearn.ensemble import RandomForestClassifier,AdaBoostClassifier,GradientBoostingClassifier

warnings.filterwarnings("ignore")


# #### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –∏—Å—Ö–æ–¥–Ω–æ–π –ø–∞–ø–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

# In[9]:


IMG_WIDTH=200
IMG_HEIGHT=200
img_folder=r'/content/training/Coat'


# #### –ü–µ—á–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã—Ö 10  –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ –æ–¥–Ω–æ–π –∏–∑ –ø–∞–ø–æ–∫

# In[10]:


import random
plt.figure(figsize=(15,15))
test_folder=r'/content/training/Coat'
for j in range(5):
    file = random.choice(os.listdir(img_folder))
    image_path= os.path.join(img_folder, file)
    img=mpimg.imread(image_path)
    ax=plt.subplot(1,5,j+1)
    ax.title.set_text(file)
    plt.imshow(img)


# In[11]:


img_folder=r'/content/training'


# #### –í —ç—Ç–æ–π —á–∞—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∏–º –∏ —Å–æ–∑–¥–∞–ª–∏–º –Ω–∞–±–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö  –≤ –∫–∞—á–µ—Å—Ç–≤–µ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–æ–¥–µ–ª–µ–π –≥–ª—É–±–æ–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è. –ó–∞–≥—Ä—É–∑–∫–∞ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —Å –ø–æ–º–æ—â—å—é Open CV2

# #### –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –º–µ—Ç–æ–∫ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –ø–∞–ø–∫–µ
# #### –í —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∏–∂–µ
# #### –ò—Å—Ö–æ–¥–Ω–∞—è –ø–∞–ø–∫–∞ ‚Äî —ç—Ç–æ –≤—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤.
# #### –ü—Ä–æ—á–∏—Ç–∞–µ–º —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –ø–∞–ø–∫–∏ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–π—Ç–µ –µ–≥–æ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ü–≤–µ—Ç–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç.
# #### –ò–∑–º–µ–Ω–∏–º —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ö–æ–¥–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –¥–ª—è –º–æ–¥–µ–ª–∏.
# #### –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –º–∞—Å—Å–∏–≤ Numpy —Å float32 –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö.
# #### –ù–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —á—Ç–æ–±—ã –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –±—ã–ª–∏ —É–º–µ–Ω—å—à–µ–Ω—ã –æ—Ç 0 –¥–æ 1 –æ—Ç 0 –¥–æ 255 –¥–ª—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–π —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

# In[12]:


def create_dataset(img_folder):
   
    img_data_array=[]
    class_name=[]
   
    for dir1 in os.listdir(img_folder):
        for file in os.listdir(os.path.join(img_folder, dir1)):
       
            image_path= os.path.join(img_folder, dir1,  file)
            image= cv2.imread( image_path, cv2.COLOR_BGR2RGB)
            image=cv2.resize(image, (IMG_HEIGHT, IMG_WIDTH),interpolation = cv2.INTER_AREA)
            image=np.array(image)
            image = image.astype('float32')
            image /= 255 
            img_data_array.append(image)
            class_name.append(dir1)
    return img_data_array, class_name


# In[13]:


img_data, class_name =create_dataset(r'./training')


# #### –ò–∑–≤–ª–µ—á–µ–º –º–∞—Å—Å–∏–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –º–µ—Ç–∫–∏ –∫–ª–∞—Å—Å–∞
# 

# In[14]:


target_dict={k: v for v, k in enumerate(np.unique(class_name))}
target_dict


# #### –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –º–µ—Ç–æ–∫ –≤ —á–∏—Å–ª–æ–≤—ã–µ –∫–æ–¥—ã

# In[15]:


target_val=  [target_dict[class_name[i]] for i in range(len(class_name))]


# #### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–π –º–æ–¥–µ–ª–∏ –≥–ª—É–±–æ–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∏ –µ–µ –∫–æ–º–ø–∏–ª—è—Ü–∏—è

# In[16]:


import matplotlib.pyplot as plt
from matplotlib import ticker
import numpy as np
import pandas as pd
import seaborn as sns

import tensorflow as tf
from tensorflow import keras
from tensorflow.keras import layers


# In[17]:


model=tf.keras.Sequential(
        [
            tf.keras.layers.InputLayer(input_shape=(IMG_HEIGHT,IMG_WIDTH, 3)),
            tf.keras.layers.Conv2D(filters=32, kernel_size=3, strides=(2, 2), activation='relu'),
            tf.keras.layers.Conv2D(filters=64, kernel_size=3, strides=(2, 2), activation='relu'),
            tf.keras.layers.Flatten(),
            tf.keras.layers.Dense(9)
        ])
model.compile(optimizer='adam', loss='sparse_categorical_crossentropy', metrics=['accuracy'])


# In[18]:


model.summary()


# #### –§–∏–ª—å—Ç—Ä—ã
# 
# ![image.png](attachment:image.png)

# –ü–µ—Ä–≤—ã–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä Conv2D ‚Äî —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥–µ—Ç –∏–∑—É—á–∞—Ç—å —Å–≤–µ—Ä—Ç–æ—á–Ω—ã–π —Å–ª–æ–π.
# 
# –°–ª–æ–∏ –≤ —Ä–∞–Ω–Ω–µ–π —Å–µ—Ç–µ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ (—Ç. –µ. –±–ª–∏–∂–µ –∫ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–º—É –≤—Ö–æ–¥–Ω–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é) –∏–∑—É—á–∞—é—Ç –º–µ–Ω—å—à–µ —Å–≤–µ—Ä—Ç–æ—á–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–µ —Å–ª–æ–∏ –≤ —Å–µ—Ç–∏ (—Ç. –µ. –±–ª–∏–∂–µ –∫ –≤—ã—Ö–æ–¥–Ω—ã–º –ø—Ä–æ–≥–Ω–æ–∑–∞–º) –∏–∑—É—á–∞—é—Ç –±–æ–ª—å—à–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤.
# 
# –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å–ª–æ–∏ Conv2D –∏–∑—É—á–∞—é—Ç –±–æ–ª—å—à–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤, —á–µ–º —Ä–∞–Ω–Ω–∏–µ —Å–ª–æ–∏ Conv2D, –Ω–æ –º–µ–Ω—å—à–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤, —á–µ–º —Å–ª–æ–∏, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–µ –±–ª–∏–∂–µ –∫ –≤—ã—Ö–æ–¥–Ω—ã–º –¥–∞–Ω–Ω—ã–º.

# #### –†–∞–∑–º–µ—Ä_—è–¥—Ä–∞
# 
# ![image.png](attachment:image.png)

# –í—Ç–æ—Ä–æ–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∫–ª–∞—Å—Å—É Keras Conv2D, ‚Äî —ç—Ç–æ kernel_size, —Å–æ—Å—Ç–æ—è—â–∏–π –∏–∑ –¥–≤—É—Ö –∫–æ—Ä—Ç–µ–∂–µ–π, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π —à–∏—Ä–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É –æ–∫–Ω–∞ 2D-—Å–≤–µ—Ä—Ç–∫–∏.
# 
# –†–∞–∑–º–µ—Ä —è–¥—Ä–∞ —Ç–∞–∫–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ—á–µ—Ç–Ω—ã–º —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º.
# 
# –¢–∏–ø–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è kernel_size –≤–∫–ª—é—á–∞—é—Ç: (1, 1) , (3, 3) , (5, 5) , (7, 7) . –†–µ–¥–∫–æ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —Ä–∞–∑–º–µ—Ä—ã —è–¥—Ä–∞ –±–æ–ª—å—à–µ 7√ó7.
# 
# –ò—Ç–∞–∫, –∫–æ–≥–¥–∞ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∫–∞–∂–¥—ã–π –∏–∑ –Ω–∏—Ö?
# 
# –ï—Å–ª–∏ –≤–∞—à–∏ –≤—Ö–æ–¥–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–æ–ª—å—à–µ 128 √ó 128, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä —è–¥—Ä–∞> 3, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å (1) –∏–∑—É—á–∏—Ç—å –±–æ–ª–µ–µ –∫—Ä—É–ø–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ (2) –ø–æ–º–æ—á—å —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ–±—ä–µ–º–∞.
# 
# –î—Ä—É–≥–∏–µ —Å–µ—Ç–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ VGGNet, –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —Ñ–∏–ª—å—Ç—Ä—ã (3, 3) –≤–æ –≤—Å–µ–π —Å–µ—Ç–∏.
# 
# –ë–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ Inception, ResNet –∏ SqueezeNet, –ø—Ä–æ–µ–∫—Ç–∏—Ä—É—é—Ç —Ü–µ–ª—ã–µ –º–∏–∫—Ä–æ–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–µ —Å–æ–±–æ–π ¬´–º–æ–¥—É–ª–∏¬ª –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑—É—á–∞—é—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –º–∞—Å—à—Ç–∞–±–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1√ó1, 3√ó3 –∏ 5√ó5), –∞ –∑–∞—Ç–µ–º –æ–±—ä–µ–¥–∏–Ω—è—é—Ç –≤—ã—Ö–æ–¥—ã.

# ### –°–î–í–ò–ì–ò

# –ü–∞—Ä–∞–º–µ—Ç—Ä strides –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –Ω–∞–±–æ—Ä –∏–∑ –¥–≤—É—Ö —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª, —É–∫–∞–∑—ã–≤–∞—é—â–∏—Ö ¬´—à–∞–≥¬ª —Å–≤–µ—Ä—Ç–∫–∏ –ø–æ –æ—Å—è–º x –∏ y –≤—Ö–æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–º–∞.
# 
# –ó–Ω–∞—á–µ–Ω–∏–µ —à–∞–≥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–≤–Ω–æ (1, 1) , —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ:
# 
# –î–∞–Ω–Ω—ã–π —Å–≤–µ—Ä—Ç–æ—á–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ —Ç–µ–∫—É—â–µ–º—É –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é –≤—Ö–æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–º–∞.
# –§–∏–ª—å—Ç—Ä –¥–µ–ª–∞–µ—Ç —à–∞–≥ –Ω–∞ 1 –ø–∏–∫—Å–µ–ª—å –≤–ø—Ä–∞–≤–æ –∏ —Å–Ω–æ–≤–∞ —Ñ–∏–ª—å—Ç—Ä –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –≤—Ö–æ–¥–Ω–æ–º—É –æ–±—ä–µ–º—É.
# –≠—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –º—ã –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ–º –∫—Ä–∞–π–Ω–µ–π –ø—Ä–∞–≤–æ–π –≥—Ä–∞–Ω–∏—Ü—ã –æ–±—ä–µ–º–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º –º—ã –ø–µ—Ä–µ–º–µ—â–∞–µ–º –Ω–∞—à —Ñ–∏–ª—å—Ç—Ä –Ω–∞ –æ–¥–∏–Ω –ø–∏–∫—Å–µ–ª—å –≤–Ω–∏–∑, –∞ –∑–∞—Ç–µ–º —Å–Ω–æ–≤–∞ –Ω–∞—á–∏–Ω–∞–µ–º —Å –∫—Ä–∞–π–Ω–µ–≥–æ –ª–µ–≤–æ–≥–æ.
# –û–±—ã—á–Ω–æ –≤—ã –æ—Å—Ç–∞–≤–ª—è–µ—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä strides —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (1, 1); –æ–¥–Ω–∞–∫–æ –∏–Ω–æ–≥–¥–∞ –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –µ–≥–æ –¥–æ (2, 2), —á—Ç–æ–±—ã —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ç–æ–º–∞ (–ø–æ—Å–∫–æ–ª—å–∫—É —Ä–∞–∑–º–µ—Ä —à–∞–≥–∞ —Ñ–∏–ª—å—Ç—Ä–∞ –±–æ–ª—å—à–µ).

# ### –§—É–Ω–∫—Ü–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
# 
# ![image.png](attachment:image.png)

# –ü–∞—Ä–∞–º–µ—Ç—Ä –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –¥–ª—è –∫–ª–∞—Å—Å–∞ Conv2D ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä —É–¥–æ–±—Å—Ç–≤–∞, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π —É–∫–∞–∑–∞—Ç—å —Å—Ç—Ä–æ–∫—É, —É–∫–∞–∑—ã–≤–∞—é—â—É—é –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—É—é –º—ã —Ö–æ—Ç–∏–º –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–≤–µ—Ä—Ç–∫–∏.
# 
# –í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã –≤—ã–ø–æ–ª–Ω—è–µ–º —Å–≤–µ—Ä—Ç–∫—É, –∞ –∑–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ ReLU:

# ### –ù–∞–∫–æ–Ω–µ—Ü-—Ç–æ –º—ã –ø–æ–¥–æ–≥–Ω–∞–ª–∏ –Ω–∞—à –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏. –ú—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Å—Å–∏–≤ Numpy –≤ –∫–∞—á–µ—Å—Ç–≤–µ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

# In[19]:


history = model.fit(x=np.array(img_data, np.float32), y=np.array(list(map(int,target_val)), np.float32),validation_split=0.2, epochs=50)


# In[20]:


print(history.history.keys())


# In[ ]:


# summarize history for accuracy
plt.plot(history.history['accuracy'])
plt.plot(history.history['val_accuracy'])
plt.title('model accuracy')
plt.ylabel('accuracy')
plt.xlabel('epoch')
plt.legend(['train', 'test'], loc='upper left')
plt.show()
# summarize history for loss
plt.plot(history.history['loss'])
plt.plot(history.history['val_loss'])
plt.title('model loss')
plt.ylabel('loss')
plt.xlabel('epoch')
plt.legend(['train', 'test'], loc='upper left')
plt.show()


# –ö–∞–∫ –º—ã –≤–∏–¥–∏–º, –ø—Ä–∏ –Ω–µ–±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏ –¥–∞—é—Ç –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç  

# #### –î–∞–≤–∞–π—Ç–µ –ø–æ–ø—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—â–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –Ω–∞ –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã—Ö –º–æ–¥–µ–ª—è—Ö, —á–µ–º –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏, –∫ –ø—Ä–∏–º–µ—Ä—É –Ω–∞ –∞–Ω—Å–∞–º–±–ª–µ–≤–æ–º –æ–±—É—á–µ–Ω–∏–∏. 

# In[22]:


nsamples, nx, ny,_ = np.array(img_data).shape
img_data = np.array(img_data).reshape((nsamples,nx*ny*3))
X_train, X_test, y_train, y_test = train_test_split(img_data, target_val, test_size=0.2, random_state=42)


# #### –ê–Ω—Å–∞–º–±–ª–µ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ –≤ —Ü–µ–ª–æ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä—è–¥–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π. –ö–æ–º–±–∏–Ω–∏—Ä—É—è –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏, –º–æ–¥–µ–ª—å –∞–Ω—Å–∞–º–±–ª—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–æ–ª–µ–µ –≥–∏–±–∫–æ–πü§∏‚Äç‚ôÄÔ∏è (–º–µ–Ω—å—à–µ –ø—Ä–µ–¥–≤–∑—è—Ç–æ—Å—Ç–∏) –∏ –º–µ–Ω–µ–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∫ –¥–∞–Ω–Ω—ã–ºüßò‚Äç‚ôÄÔ∏è (–º–µ–Ω—å—à–µ –¥–∏—Å–ø–µ—Ä—Å–∏–∏).

# –î–≤—É–º—è –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–º–∏ –∞–Ω—Å–∞–º–±–ª–µ–≤—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ —è–≤–ª—è—é—Ç—Å—è –±—ç–≥–≥–∏–Ω–≥ –∏ –±—É—Å—Ç–∏–Ω–≥.
# 
# –ë—ç–≥–≥–∏–Ω–≥: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π. –ö–∞–∂–¥–∞—è –º–æ–¥–µ–ª—å –æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–µ –¥–∞–Ω–Ω—ã—Ö
# 
# –ë—É—Å—Ç–∏–Ω–≥: –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π. –ö–∞–∂–¥–∞—è –æ—Ç–¥–µ–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å —É—á–∏—Ç—Å—è –Ω–∞ –æ—à–∏–±–∫–∞—Ö, –¥–æ–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥—ã–¥—É—â–µ–π –º–æ–¥–µ–ª—å—é.

# ### 1 –°–ª—É—á–∞–π–Ω—ã–π –ª–µ—Å
# –°–ª—É—á–∞–π–Ω—ã–π –ª–µ—Å ‚Äî —ç—Ç–æ –º–æ–¥–µ–ª—å –∞–Ω—Å–∞–º–±–ª—è, –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è –±—ç–≥–≥–∏–Ω–≥ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –º–µ—Ç–æ–¥–∞ –∞–Ω—Å–∞–º–±–ª—è –∏ –¥–µ—Ä–µ–≤–æ —Ä–µ—à–µ–Ω–∏–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Ç–¥–µ–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏.

# In[23]:


# –®–∞–≥ 1: –ü–æ–¥–≥–æ–Ω–∫–∞ –º–æ–¥–µ–ª–∏ –¥–µ—Ä–µ–≤–∞ —Ä–µ—à–µ–Ω–∏–π
clf = DecisionTreeClassifier()
clf.fit(X_train, y_train)
y_pred = clf.predict(X_test)
accuracy_score(y_test, y_pred)


# In[24]:


# –®–∞–≥ 2: –°–æ–ø–æ—Å—Ç–∞–≤—å—Ç–µ –º–æ–¥–µ–ª—å —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ª–µ—Å–∞
clf = RandomForestClassifier(n_estimators=100, max_features="auto",random_state=0)
clf.fit(X_train, y_train)
y_pred = clf.predict(X_test)
accuracy_score(y_test, y_pred)


# ### AdaBoost (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ)
# AdaBoost ‚Äî —ç—Ç–æ –ø–æ–≤—ã—à–∞—é—â–∞—è –∞–Ω—Å–∞–º–±–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ —Ö–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–µ—Ä–µ–≤–æ–º —Ä–µ—à–µ–Ω–∏–π. –ö–ª—é—á–æ–º –∫ –º–æ–¥–µ–ª–∏ –ø–æ–≤—ã—à–µ–Ω–∏—è —è–≤–ª—è–µ—Ç—Å—è –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –æ—à–∏–±–∫–∞—Ö, —Ç.–µ. —Ç–æ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏.
# AdaBoost —É—á–∏—Ç—Å—è –Ω–∞ –æ—à–∏–±–∫–∞—Ö, —É–≤–µ–ª–∏—á–∏–≤–∞—è –≤–µ—Å –æ—à–∏–±–æ—á–Ω–æ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö.

# In[35]:


# –®–∞–≥ 3: –º–æ–¥–µ–ª—å AdaBoost
clf = AdaBoostClassifier(n_estimators=100)
clf.fit(X_train, y_train)
y_pred = clf.predict(X_test)
accuracy_score(y_test, y_pred)


# In[ ]:


from sklearn.model_selection import GridSearchCV
params = {
     'n_estimators': np.arange(10,300,100),
     'learning_rate': [0.01, 0.05, 0.1, 1],
 }
grid_cv = GridSearchCV(AdaBoostClassifier(), param_grid= params, cv=5, n_jobs=-1)
grid_cv.fit(X_train, y_train)
grid_cv.best_params_


# In[ ]:



accuracy_score(y_test, grid_cv.predict(grid_cv))


# ### –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –±—É—Å—Ç–∏–Ω–≥
# –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –±—É—Å—Ç–∏–Ω–≥ ‚Äî –µ—â–µ –æ–¥–Ω–∞ –º–æ–¥–µ–ª—å –ø–æ–≤—ã—à–µ–Ω–∏—è. –ö–ª—é—á–æ–º –∫ –ø–æ–≤—ã—à–µ–Ω–∏—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏ —è–≤–ª—è–µ—Ç—Å—è –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –æ—à–∏–±–∫–∞—Ö.
# Gradient Boosting —É—á–∏—Ç—Å—è –Ω–∞ –æ—à–∏–±–∫–µ ‚Äî –æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –æ—à–∏–±–∫–µ –Ω–∞–ø—Ä—è–º—É—é, –∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤–µ—Å–∞ —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö.

# In[ ]:


# –®–∞–≥ 4: –º–æ–¥–µ–ª—å –ø–æ–≤—ã—à–µ–Ω–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞
clf = GradientBoostingClassifier(n_estimators=100)
clf.fit(X_train, y_train)
y_pred = clf.predict(X_test)
accuracy_score(y_test, y_pred)


# In[ ]:


from sklearn.ensemble import GradientBoostingClassifier

from sklearn.model_selection import GridSearchCV
from sklearn.metrics import accuracy_score
from sklearn.metrics import precision_score
from sklearn.metrics import recall_score
from sklearn.metrics import make_scorer
#—Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –æ—Ü–µ–Ω–∫–∏:

scoring = {'accuracy': make_scorer(accuracy_score),
           'precision': make_scorer(precision_score),'recall':make_scorer(recall_score)}

# –ü—Ä–∏–º–µ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
parameters = {
    "loss":["deviance"],
    "learning_rate": [0.01, 0.025, 0.05, 0.075, 0.1, 0.15, 0.2],
    "min_samples_split": np.linspace(0.1, 0.5, 12),
    "min_samples_leaf": np.linspace(0.1, 0.5, 12),
    "max_depth":[3,5,8],
    "max_features":["log2","sqrt"],
    "criterion": ["friedman_mse",  "mae"],
    "subsample":[0.5, 0.618, 0.8, 0.85, 0.9, 0.95, 1.0],
    "n_estimators":[10]
    }
# –ø–µ—Ä–µ–¥–∞—á–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–¥—Å—á–µ—Ç–∞ –æ—á–∫–æ–≤ –≤ GridSearchCV
clf = GridSearchCV(GradientBoostingClassifier(), parameters,scoring=scoring,refit=False,cv=2, n_jobs=-1)

clf.fit(X_train, y_train)
# –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ clf.cv_results –≤ —Ñ—Ä–µ–π–º –¥–∞–Ω–Ω—ã—Ö
df=pd.DataFrame.from_dict(clf.cv_results_)
#–∑–¥–µ—Å—å –í–æ–∑–º–æ–∂–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏: cv=2, –µ—Å—Ç—å –¥–≤–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è split0 –∏ split1
df[['split0_test_accuracy','split1_test_accuracy','split0_test_precision','split1_test_precision','split0_test_recall','split1_test_recall']]


# In[ ]:


#–Ω–∞–π—Ç–∏ –ª—É—á—à–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ precision_score
# –≤–∑—è–≤ —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—é "—Ç–æ—á–Ω–æ—Å—Ç—å_–ø–æ–∫–∞–∑–∞—Ç–µ–ª—è"
df['accuracy_score']=(df['split0_test_accuracy']+df['split1_test_accuracy'])/2

df.loc[df['accuracy_score'].idxmax()]['params']


# –í —Ü–µ–ª–æ–º, –∞–Ω—Å–∞–º–±–ª–µ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ –æ—á–µ–Ω—å –º–æ—â–Ω–æ–µ –∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏, –Ω–æ –∏ –¥–ª—è —Ä–µ–≥—Ä–µ—Å—Å–∏–∏. –ù–æ –≤ –∑–∞–¥–∞—á–∞—Ö –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ–Ω–∏ –≤—Å–µ –∂–µ –Ω–µ –ø–æ–ª—å–∑—É—é—Ç—Å—è –±–æ–ª—å—à–æ–π –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å—é, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –º–∞—Å—Å–∏–≤–∞—Ö –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø—Ä–æ—Å—Ç–æ –æ—á–µ–Ω—å –¥–æ–ª–≥–∏–º–∏ –∏ –Ω–µ —Ç–∞–∫–∏–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º–∏, –∫–∞–∫ –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏.
